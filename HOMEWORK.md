# Домашние задания

## ДЗ №1 «Утилита для управления ПВЗ»
### Цель
Реализовать консольную утилиту для менеджера ПВЗ

### Основное задание
- [x] Программа должна обладать командой help, благодаря которой можно получить список доступных команд с кратким описанием
- [x] Реализовать основные команды
  - **Принять заказ от курьера**
   На вход принимается ID заказа, ID получателя и срок хранения. Заказ нельзя принять дважды. Если срок хранения в прошлом, приложение должно выдать ошибку. Список принятых заказов необходимо сохранять в файл. Формат файла остается на выбор автора.
  - **Вернуть заказ курьеру**
    На вход принимается ID заказа. Метод должен удалять заказ из вашего файла. Можно вернуть только те заказы, у которых вышел срок хранения и если заказы не были выданы клиенту.
  - **Выдать заказ клиенту**
    На вход принимается список ID заказов. Можно выдавать только те заказы, которые были приняты от курьера и чей срок хранения меньше текущей даты. Все ID заказов должны принадлежать только одному клиенту.
  - **Получить список заказов**
    На вход принимается ID пользователя как обязательный параметр и опциональные параметры.
    Параметры позволяют получать только последние N заказов или заказы клиента, находящиеся в нашем ПВЗ.
  - **Принять возврат от клиента**
      На вход принимается ID пользователя и ID заказа. Заказ может быть возвращен в течение двух дней с момента выдачи. Также необходимо проверить, что заказ выдавался с нашего ПВЗ.
  - **Получить список возвратов**
    Метод должен выдавать список пагинированно.

### Дополнительное задание
- [x] Программа запускается и ожидает поступление команд
- [x] Пользователь набирает команду и нажимает клавишу Enter
- [x] После нажатия клавиши Enter, программа выполняет введенную команду и записывает изменения в файл
- [x] Программа ожидает ввода новой команды
- [x] Программа завершает выполнение после нажатия комбинации клавиш ctrl+c или ввода команды exit
- [x] При выполнении команды в выходной файл записывается/обновляется дополнительное поле "hash"
- [x] Дополнительное поле "hash" считается с помощью функции `hash.GenerateHash()`  
   Функция GenerateHash() - это сторонняя функция, которую нужно импортировать и использовать, реализовывать её не нужно, она предоставляется преподавателям или тьютором.
   Функция GenerateHash() работает "долго", например, несколько секунд. Использование функции замедляет выполнение команды и не позволяет ввести следующую команду
- [x] Придумайте свой/свои интерфейсы и используйте их в вашей программе. Продемонстрируйте усвоение учебного материала об интерфейсах


## ДЗ №2 «Ускорение обработки данных»
### Цель
Модифицировать приложение, чтобы процесс обработки данных занимал меньше времени

### Основное задание
- [x] Приложение должно работать в независимом режиме. Пользователь может передавать следующую команду, не дожидаясь результатов предыдущей
- [x] Ускорьте работу вашего приложения. Реализуйте обработку заданий в два потока, используя один из изученных паттернов конкурентной разработки
- [x] Приложение должно использовать механизм блокировки (например, мьютекс) для синхронизации доступа к данным между процессами

### Дополнительное задание
- [x] Добавьте обработку системных сигналов, таких как SIGINT (Ctrl+C) и SIGTERM, чтобы корректно завершить работу приложения. При получении сигнала приложение должно завершить все задачи до выхода из консоли (graceful shutdown)
- [x] Добавьте управление кол-вом горутин через отдельную команду для выполнения. Т.е. кол-во горутин должно изменяться динамически, без рестарта приложения
- [x] Добавить нотификации о начале и окончании обработки команды для каждой горутины. Реализовать в отдельной горутине
- [x] Для реагирования на системные сигналы вы можете использовать пакет os/signal в Go
- [x] Для синхронизации доступа к файлу между процессами записи и чтения вы можете использовать пакет sync и его мьютексы
- [x] Для работы с файлами в Go вы можете использовать пакет os или io/ioutil


## ДЗ №3 «Рефакторинг слоя базы данных»
### Цель
Модифицировать приложение так, чтобы взаимодействие с хранением данных было через Postgres, а не через файл

### Основное задание
- [x] Переведите ваше приложение с хранения данных в файле на Postgres
- [x] Реализуйте миграцию для DDL операторов
- [x] Используйте транзакции

### Дополнительное задание
- [ ] Проанализируйте запросы в БД. Приложите результаты анализа в README.md. Добавьте индексы, где это необходимо
- [ ] Помните, что в одном файле миграции должен находиться один DDL оператор
- [ ] Для анализа плана запросов используйте Explain Tensor


## ДЗ №4 «Выдача заказов в разной упаковке»
### Цель
Модифицировать ваш сервис, добавить возможность в ПВЗ выдавать заказы в любой из трех различных упаковок

### Основное задание
- [x] Модифицируйте Go-приложение, добавьте в метод "Принять заказ от курьера" возможность передавать параметр упаковки
- [x] Всего есть три вида упаковки: пакет, коробка, пленка
- [x] Реализуйте функционал так, чтобы в будущем можно было просто добавить еще один вид упаковки
- [x] При выборе пакета необходимо проверять, что вес заказа меньше 10 кг, если нет, то возвращаем информативную ошибку
- [x] При выборе пакета стоимость заказа увеличивается на 5 рублей
- [x] При выборе коробки необходимо проверить, что вес заказа меньше 30 кг, если нет, то возвращаем информативную ошибку
- [x] При выборе коробки стоимость заказа увеличивается на 20 рублей
- [x] При выборе пленки дополнительных проверок не требуется
- [x] При выборе пленки стоимость заказа увеличивается на 1 рубль

### Дополнительное задание
- [ ] Опишите архитектуру своего решения любым известным стандартом (например, UML)
- [ ] В MR вложите файл с описанием архитектуры
- [ ] При выборе стандарта необходимо описать, какой был выбран стандарт и дать ссылку на его документацию
- [ ] Запрещается использовать генерилки диаграмм, а также инструменты генерации связей между таблицами в БД в качестве описания


## ДЗ №5 «Тестирование»
### Цель
Протестировать приложение

### Основное задание
- [x] Отрефакторить код предыдущих ДЗ (если необходимо). Применить подход DI, переписать методы БД на использование интерфейсов
- [x] Покрыть Unit-тестами функционал, написанный в рамках предыдущих ДЗ. Unit-тесты должны быть параллельными и не аффектить друг друга
- [x] Покрыть интеграционными тестами всю работу с базой данных (читающие и пишущие методы)
- [ ] Подготовить Makefile, в котором будут следующие команды: запуск тестового окружения при помощи docker-compose, запуск интеграционных тестов, запуск Unit-тестов, запуск скрипта миграций, очищение базы от тестовых данных

### Дополнительное задание
- [ ] Написать интеграционные тесты с помощью тест-сьютов (https://github.com/stretchr/testify/blob/master/suite/suite_test.go). Сьюты не исключают написание интеграционных тестов в классическом формате


## ДЗ №6 «Логирование обращений в методы через Kafka»
### Цель
Вывести события по обращениям в методы сервиса в консоль

### Основное задание
- [ ] При вызове любого API метода (консольная команда) записываем событие об этом в Kafka
- [ ] Событие должно хранить время обращения, название метода и сырой запрос
- [ ] По ходу работы приложения в консоль необходимо выводить эти события из Kafka
- [ ] Необходимо сделать настройку-свитч, которая будет переключать между выводом напрямую в консоль и выводом через Kafka. Оба варианта сразу делать нельзя. Настройка должна подгружаться при старте приложения
- [ ] Решение должно быть покрыто Unit-тестами

### Дополнительное задание
- [ ] Написать интеграционные тесты на взаимодействие с Kafka


## ДЗ №7 «Работа с gRPC»
### Цель
Перевести проект на работу с gRPC

### Основное задание
- [ ] Создать proto контракт сервиса
- [ ] В проекте нужно добавить в Makefile команды для генерации .go файлов из proto файлов и установки нужных зависимостей (можно использовать protoc или buf на свое усмотрение)
- [ ] Сгенерировать gRPC сервис
- [ ] Покрыть gRPC-хендлеры тестами

### Дополнительное задание
- [ ] Добавить HTTP-gateway и валидацию protobuf сообщений
- [ ] Добавить swagger-ui и возможность совершать запросы из сваггера к сервису (поднять swagger-ui сервер)


## ДЗ №8 «Дорога к реальным сервисам»
### Цель
Оптимизация нагрузки на сервис, наблюдение и контроль работы сервиса

### Основное задание
- [ ] Реализуйте простое кеширование (in-memory cache) для уменьшения нагрузки на базу данных вашего приложения
- [ ] Внедрите механизм валидации кеша, объясните свой выбор в документации пакета кеш клиента (godoc/md)
- [ ] Необходимо реализовать сбор метрик с вашего приложения. Добавьте кастомную метрику по количеству выданных заказов

### Дополнительное задание
- [ ] Добавьте ограничение потребления ресурсов вашего кеша (LRU/LFU или их модификации). Обновите документацию пакета кеширования
- [ ] Добавьте трейсинг запросов внутри приложения
- [ ] Выделите пакет кеширования в потенциально универсальный, с generic-типами ключей и значений и конфигурацией снаружи (стратегия кеширования для экономии ресурсов, TTL кешированных значений и др.)
